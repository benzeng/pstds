**ä¸ªäººä¸“ç”¨è‚¡ç¥¨äº¤æ˜“å†³ç­–ç³»ç»Ÿ**

PSTDS â€” Personal Stock Trading Decision System

**æµ‹è¯•è§„èŒƒæ–‡æ¡£ï¼ˆTSDï¼‰v2.0**

Test Specification Document \| 2026å¹´3æœˆ \| ç‰ˆæœ¬ v2.0

# 1. æµ‹è¯•ç­–ç•¥æ€»è§ˆï¼ˆv2.0 æ›´æ–°ï¼‰

v2.0 åœ¨ TSD v1.0 åŸºç¡€ä¸Šæ–°å¢ä¸‰ä¸ªæµ‹è¯•å¥—ä»¶ï¼šNewsFilter ä¸‰çº§è¿‡æ»¤æµ‹è¯•ï¼ˆNF ç³»åˆ—ï¼‰ã€PortfolioAnalyzer æµ‹è¯•ï¼ˆPA ç³»åˆ—ï¼‰ã€è®°å¿†ç³»ç»Ÿæµ‹è¯•ï¼ˆMS ç³»åˆ—ï¼‰ã€‚å›å½’æµ‹è¯•æ–°å¢ REG-006 å’Œ REG-007 ä¸¤ä¸ªç”¨ä¾‹ï¼Œè¦†ç›–è®°å¿†ç³»ç»Ÿä¸å¼•å…¥æœªæ¥æ•°æ®å’Œç»„åˆåˆ†ææ—¶é—´éš”ç¦»ã€‚

| **æµ‹è¯•çº§åˆ«**  | **è¦†ç›–ç›®æ ‡**                                     | **ä¼˜å…ˆçº§** | **è¦†ç›–ç‡è¦æ±‚**     | **v2.0å˜æ›´**                   |
|---------------|--------------------------------------------------|------------|--------------------|--------------------------------|
| L1 å•å…ƒæµ‹è¯•   | TemporalGuard / Pydantic / è·¯ç”±è§„åˆ™ / ç¼“å­˜é€»è¾‘   | ğŸ”´ æœ€é«˜    | \>95%ï¼ˆtemporal/ï¼‰ | æ— å˜æ›´ï¼Œç”¨ä¾‹ TG/PM/RT ç³»åˆ—ä¸å˜ |
| L1 æ–°å¢       | NewsFilter / PortfolioAnalyzer / PositionAdvisor | ğŸ”´ é«˜      | \>80%              | â­ æ–°å¢ NF/PA ç³»åˆ—             |
| L2 é€‚é…å™¨æµ‹è¯• | å„é€‚é…å™¨å¥‘çº¦ + DeepSeek/DashScope æ–°é€‚é…å™¨       | ğŸ”´ é«˜      | \>80%              | â­ æ–°å¢ DS/QW ç³»åˆ—             |
| L3 é›†æˆæµ‹è¯•   | å®Œæ•´åˆ†ææµç¨‹ç«¯åˆ°ç«¯ + ç»„åˆåˆ†ææµç¨‹                | ğŸŸ  ä¸­é«˜    | å…³é”®è·¯å¾„100%       | â­ æ–°å¢ PA-INT ç³»åˆ—            |
| L4 å›å½’æµ‹è¯•   | å‰è§†åå·® + å†³ç­–ä¸€è‡´æ€§ + è®°å¿†æ—¶é—´éš”ç¦»             | ğŸ”´ æœ€é«˜    | å¿…é¡»100%é€šè¿‡       | â­ æ–°å¢ REG-006/007            |
| L5 æˆæœ¬æµ‹è¯•   | Tokené¢„ç®—ç®¡æ§ + DeepSeekæˆæœ¬éªŒè¯                 | ğŸŸ¡ ä¸­      | æ ¸å¿ƒè·¯å¾„è¦†ç›–       | â­ æ–°å¢ DeepSeek æˆæœ¬ç”¨ä¾‹      |

# 2. å•å…ƒæµ‹è¯•è§„èŒƒï¼ˆv2.0 æ–°å¢å¥—ä»¶ï¼‰

## 2.1 TemporalGuard æµ‹è¯•å¥—ä»¶ï¼ˆä¸ TSD v1.0 ç›¸åŒï¼‰

> ğŸ“Œ TG-001 åˆ° TG-012 å…±12ä¸ªç”¨ä¾‹ä¸ TSD v1.0 ç¬¬ 2.1 èŠ‚å®Œå…¨ä¸€è‡´ã€‚è¦†ç›–ç‡è¦æ±‚100%ã€‚

## 2.2 NewsFilter æµ‹è¯•å¥—ä»¶ï¼ˆv2.0 æ–°å¢ï¼‰

> âš ï¸ NewsFilter æ˜¯ v3.0 è¡¥å…¨å®ç°çš„æ ¸å¿ƒç»„ä»¶ï¼Œæµ‹è¯•ä¼˜å…ˆçº§ä¸ TemporalGuard åŒçº§ã€‚

| **æµ‹è¯•ID** | **æµ‹è¯•åç§°**                   | **æµ‹è¯•å†…å®¹**                                       | **é¢„æœŸç»“æœ**                                               |
|------------|--------------------------------|----------------------------------------------------|------------------------------------------------------------|
| NF-001     | test_l1_temporal_filter        | L1è¿‡æ»¤ï¼šå«3æ¡æœªæ¥æ–°é—» + 5æ¡åˆè§„æ–°é—»                | è¿”å›5æ¡ï¼Œtemporal_filtered=3                               |
| NF-002     | test_l2_relevance_filter_tfidf | L2è¿‡æ»¤ï¼ˆTF-IDFï¼‰ï¼šå«4æ¡é«˜ç›¸å…³ + 3æ¡ä½ç›¸å…³ï¼ˆ\<0.6ï¼‰ | è¿”å›4æ¡ï¼Œrelevance_filtered=3                              |
| NF-003     | test_l2_threshold_configurable | L2é˜ˆå€¼è®¾ä¸º0.8æ—¶è¿‡æ»¤æ›´ä¸¥æ ¼                          | æ¯”é»˜è®¤é˜ˆå€¼å°‘è¿”å›è‡³å°‘1æ¡                                    |
| NF-004     | test_l3_dedup_removes_similar  | L3å»é‡ï¼š2æ¡ç›¸ä¼¼åº¦0.92çš„æ–°é—»ï¼ˆä¸€æ—©ä¸€æ™šï¼‰            | è¿”å›1æ¡ï¼ˆè¾ƒæ—©å‘å¸ƒçš„ï¼‰ï¼Œdedup_filtered=1                    |
| NF-005     | test_l3_keeps_dissimilar       | L3å»é‡ï¼š2æ¡ç›¸ä¼¼åº¦0.40çš„æ–°é—»                        | ä¸¤æ¡å‡ä¿ç•™ï¼Œdedup_filtered=0                               |
| NF-006     | test_pipeline_order            | éªŒè¯è¿‡æ»¤é¡ºåºï¼šL1â†’L2â†’L3                             | stats.after_temporal \<= stats.after_relevanceï¼ˆå•è°ƒé€’å‡ï¼‰ |
| NF-007     | test_pure_function             | è¿ç»­ä¸¤æ¬¡ç”¨ç›¸åŒè¾“å…¥è°ƒç”¨filter()                     | ä¸¤æ¬¡è¿”å›ç›¸åŒç»“æœï¼Œè¾“å…¥åˆ—è¡¨æœªè¢«ä¿®æ”¹                         |
| NF-008     | test_empty_input               | è¾“å…¥ç©ºåˆ—è¡¨                                         | è¿”å›(\[\], NewsFilterStats(0,0,0,0))ï¼Œä¸æŠ›å‡ºå¼‚å¸¸           |
| NF-009     | test_l2_failure_degrades_to_l1 | Mock TF-IDF è®¡ç®—æŠ›å‡ºå¼‚å¸¸                           | é™é»˜é™çº§ï¼Œè¿”å›L1è¿‡æ»¤ç»“æœï¼Œè®°å½•è­¦å‘Šæ—¥å¿—                     |
| NF-010     | test_stats_accuracy            | å·²çŸ¥è¾“å…¥ï¼ŒéªŒè¯å››ä¸ªè®¡æ•°å­—æ®µå‡†ç¡®æ€§                   | raw/temporal/relevance/dedup ä¸å®é™…æ¡æ•°å®Œå…¨åŒ¹é…            |

## 2.3 PortfolioAnalyzer æµ‹è¯•å¥—ä»¶ï¼ˆv2.0 æ–°å¢ï¼‰

| **æµ‹è¯•ID** | **æµ‹è¯•åç§°**                       | **æµ‹è¯•å†…å®¹**                                      | **é¢„æœŸç»“æœ**                                      |
|------------|------------------------------------|---------------------------------------------------|---------------------------------------------------|
| PA-001     | test_correlation_two_stocks        | 2åªè‚¡ç¥¨90å¤©ç›¸å…³ç³»æ•°è®¡ç®—                           | è¿”å›2Ã—2 DataFrameï¼Œå¯¹è§’çº¿ä¸º1.0ï¼Œå€¼åœ¨\[-1, 1\]èŒƒå›´ |
| PA-002     | test_correlation_time_isolation    | ç›¸å…³æ€§è®¡ç®— end_date = ctx.analysis_date+1         | æŠ›å‡º TemporalViolationErrorï¼ˆE001ï¼‰               |
| PA-003     | test_correlation_insufficient_days | ä¸¤åªè‚¡ç¥¨å…±åŒäº¤æ˜“æ—¥ä»…20å¤©ï¼ˆ\< min_common_days=30ï¼‰ | è¿”å› Noneï¼Œè®°å½• PortfolioDataErrorï¼ˆE011ï¼‰è­¦å‘Š    |
| PA-004     | test_hhi_concentrated              | 3åªè‚¡ç¥¨å„1/3ä»“ä½                                  | HHI â‰ˆ 0.333                                       |
| PA-005     | test_hhi_single_stock              | 1åªè‚¡ç¥¨100%ä»“ä½                                   | HHI = 1.0                                         |
| PA-006     | test_stress_test_negative          | æ­£å¸¸å¸‚åœºæ•°æ®ï¼ˆæœ‰å†å²è·Œå¹…ï¼‰                        | è¿”å›è´Ÿæ•°ï¼ˆæŸå¤±ï¼‰                                  |
| PA-007     | test_volatility_contribution_sum   | ä»»æ„è‚¡ç¥¨ç»„åˆ                                      | æ‰€æœ‰è´¡çŒ®æ¯”ä¾‹ä¹‹å’Œ = 100%ï¼ˆÂ±0.01ï¼‰                  |

## 2.4 PositionAdvisor æµ‹è¯•å¥—ä»¶ï¼ˆv2.0 æ–°å¢ï¼‰

| **æµ‹è¯•ID** | **æµ‹è¯•åç§°**                          | **æµ‹è¯•å†…å®¹**                         | **é¢„æœŸç»“æœ**                                             |
|------------|---------------------------------------|--------------------------------------|----------------------------------------------------------|
| PV-001     | test_strong_buy_maps_020              | action=STRONG_BUY çš„åˆå§‹ä»“ä½æ˜ å°„     | initial_weight = 0.20                                    |
| PV-002     | test_hhi_constraint_triggers          | HHI \> max_hhiï¼ˆ0.35ï¼‰æ—¶è§¦å‘è°ƒæ•´     | adjusted_weight \< initial_weightï¼Œadjustment_reasonéç©º |
| PV-003     | test_hhi_after_adjustment             | è°ƒæ•´å HHI çº¦æŸéªŒè¯                  | hhi(adjusted_weights) \<= max_hhi                        |
| PV-004     | test_total_weight_under_100           | ä»»æ„è‚¡ç¥¨ç»„åˆ                         | sum(adjusted_weights) \<= 1.0                            |
| PV-005     | test_operation_with_current_positions | æä¾› current_positionsï¼Œè°ƒæ•´å»ºè®®ä»“ä½ | operation å­—æ®µæ ¹æ®å¢å‡æ­£ç¡®è¿”å› BUY/SELL/HOLD             |
| PV-006     | test_insufficient_data_zero_weight    | action=INSUFFICIENT_DATA             | initial_weight=0.0ï¼Œoperation=HOLD                       |

## 2.5 æ•°æ®æ¨¡å‹æµ‹è¯•å¥—ä»¶ï¼ˆä¸ TSD v1.0 ç›¸åŒï¼‰

> ğŸ“Œ PM-001 åˆ° PM-008 ä¸ TSD v1.0 ç¬¬ 2.2 èŠ‚å®Œå…¨ä¸€è‡´ã€‚v2.0 æ–°å¢ PM-009ã€‚

| **æµ‹è¯•ID** | **æµ‹è¯•å†…å®¹**                                                      | **é¢„æœŸç»“æœ**                          |
|------------|-------------------------------------------------------------------|---------------------------------------|
| PM-009     | TradeDecision å« portfolio_impact=PortfolioImpact(...) æ—¶åˆ›å»ºæˆåŠŸ | åˆ›å»ºæˆåŠŸï¼Œportfolio_impact å­—æ®µå¯è®¿é—® |

# 3. é€‚é…å™¨å¥‘çº¦æµ‹è¯•ï¼ˆv2.0 æ–°å¢ï¼‰

> ğŸ“Œ YF-001~YF-005 å’Œ AK-001~AK-005 ä¸ TSD v1.0 ç¬¬ 3 èŠ‚å®Œå…¨ä¸€è‡´ï¼Œä½¿ç”¨ Fixture æ•°æ®ï¼Œä¸è¿›è¡ŒçœŸå®ç½‘ç»œè¯·æ±‚ã€‚

## 3.1 DeepSeekClient æµ‹è¯•ï¼ˆv2.0 æ–°å¢ï¼‰

| **æµ‹è¯•ID** | **æµ‹è¯•å†…å®¹**                                             | **ä½¿ç”¨æ–¹å¼**                              |
|------------|----------------------------------------------------------|-------------------------------------------|
| DS-001     | æ­£å¸¸è°ƒç”¨è¿”å›æ–‡æœ¬å†…å®¹                                     | Mock HTTP è¯·æ±‚ï¼Œè¿”å›200 + åˆæ³•å“åº”JSON    |
| DS-002     | temperature å›ºå®šä¸º 0.0ï¼Œä¸å—å¤–éƒ¨å‚æ•°å½±å“                 | æ£€æŸ¥ Mock è°ƒç”¨æ—¶ä¼ å…¥çš„ temperature å‚æ•°å€¼ |
| DS-003     | DEEPSEEK_API_KEY æœªè®¾ç½®æ—¶æŠ›å‡º ConfigurationErrorï¼ˆE010ï¼‰ | æ¸…é™¤ç¯å¢ƒå˜é‡ååˆå§‹åŒ–                      |
| DS-004     | 429å“åº”è§¦å‘æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰                       | Mock è¿ç»­3æ¬¡429ï¼Œç¬¬4æ¬¡200ï¼ŒéªŒè¯é‡è¯•æ¬¡æ•°   |
| DS-005     | è¿ç»­3æ¬¡429åæŠ›å‡º LLMRateLimitErrorï¼ˆE006ï¼‰               | Mock æŒç»­è¿”å›429                          |

## 3.2 DashScopeClient æµ‹è¯•ï¼ˆv2.0 æ–°å¢ï¼‰

| **æµ‹è¯•ID** | **æµ‹è¯•å†…å®¹**                                            | **é¢„æœŸç»“æœ**                                                    |
|------------|---------------------------------------------------------|-----------------------------------------------------------------|
| QW-001     | æ­£å¸¸è°ƒç”¨è¿”å›ä¸­æ–‡æ–‡æœ¬                                    | è¿”å›éç©ºå­—ç¬¦ä¸²                                                  |
| QW-002     | DASHSCOPE_API_KEY æœªè®¾ç½®æ—¶æŠ›å‡º ConfigurationError       | æŠ›å‡º E010                                                       |
| QW-003     | qwen-max æ¨¡å‹ market_type=CN_A æ—¶è¢« LLMFactory ä¼˜å…ˆé€‰æ‹© | LLMFactory.create(market_type="CN_A") è¿”å› DashScopeClient å®ä¾‹ |

# 4. é›†æˆæµ‹è¯•è§„èŒƒï¼ˆv2.0 æ–°å¢ï¼‰

> ğŸ“Œ INT-001 åˆ° INT-007 ä¸ TSD v1.0 ç¬¬ 4.1 èŠ‚å®Œå…¨ä¸€è‡´ã€‚v2.0 æ–°å¢ä»¥ä¸‹ç”¨ä¾‹ã€‚

## 4.1 NewsFilter é›†æˆæµ‹è¯•ï¼ˆv2.0 æ–°å¢ï¼‰

| **æµ‹è¯•ID** | **æµ‹è¯•å†…å®¹**                                             | **éªŒè¯é‡ç‚¹**                                                                   |
|------------|----------------------------------------------------------|--------------------------------------------------------------------------------|
| INT-008    | AAPL L1 çº§åˆ†æï¼ŒéªŒè¯ news_filter_stats å­˜åœ¨äº GraphState | stats.raw_count \> 0ï¼›stats.after_dedup \<= stats.raw_count                    |
| INT-009    | L1 åˆ†æï¼Œæ•…æ„æ³¨å…¥å«æœªæ¥æ—¥æœŸæ–°é—»çš„ Fixture æ•°æ®           | news_filter_stats.temporal_filtered \> 0ï¼Œæœªæ¥æ–°é—»ä¸å‡ºç°åœ¨ news_analyst è¾“å…¥ä¸­ |

## 4.2 ç»„åˆåˆ†æé›†æˆæµ‹è¯•ï¼ˆv2.0 æ–°å¢ï¼‰

| **æµ‹è¯•ID** | **æµ‹è¯•å†…å®¹**                                       | **éªŒè¯é‡ç‚¹**                                                       |
|------------|----------------------------------------------------|--------------------------------------------------------------------|
| PA-INT-001 | 3åªè‚¡ç¥¨æ‰¹é‡åˆ†æï¼Œä½¿ç”¨ Fixture OHLCV æ•°æ®           | PortfolioCoordinator è¾“å‡º List\[PositionAdvice\]ï¼Œæ€»ä»“ä½ â‰¤ 100%    |
| PA-INT-002 | é«˜ç›¸å…³è‚¡ç¥¨å¯¹ï¼ˆMock ç›¸å…³ç³»æ•°0.85ï¼‰è§¦å‘ HHI çº¦æŸè°ƒæ•´ | è‡³å°‘ä¸€åªè‚¡ç¥¨çš„ adjusted_weight \< initial_weight                   |
| PA-INT-003 | ç»„åˆåˆ†æç»“æœå†™å…¥ MongoDB portfolio_snapshots       | é›†åˆä¸­å­˜åœ¨å¯¹åº”æ–‡æ¡£ï¼Œcorrelation_matrix å­—æ®µå¯ååºåˆ—åŒ–              |
| PA-INT-004 | ç»„åˆåˆ†æ analysis_date æ ¡éªŒ                        | ä½¿ç”¨ ctx.analysis_date+1 çš„ä»·æ ¼æ•°æ®æ—¶ï¼ŒæŠ›å‡º TemporalViolationError |

## 4.3 è®°å¿†ç³»ç»Ÿé›†æˆæµ‹è¯•ï¼ˆv2.0 æ–°å¢ï¼‰

| **æµ‹è¯•ID** | **æµ‹è¯•å†…å®¹**                                                      | **éªŒè¯é‡ç‚¹**                                                    |
|------------|-------------------------------------------------------------------|-----------------------------------------------------------------|
| MS-INT-001 | åˆ†æå®Œæˆå EpisodicMemory.add_decision() è¢«è°ƒç”¨                   | ChromaDB ä¸­å­˜åœ¨å¯¹åº”å‘é‡ï¼ˆMock ChromaDBéªŒè¯è°ƒç”¨ï¼‰                |
| MS-INT-002 | ChromaDB ä¸å¯ç”¨æ—¶åˆ†ææµç¨‹æ­£å¸¸å®Œæˆ                                 | æ— å¼‚å¸¸ï¼Œæ—¥å¿—ä¸­æœ‰é™çº§è­¦å‘Šï¼ŒTradeDecision æ­£å¸¸è¾“å‡º                |
| MS-INT-003 | ç¬¬äºŒæ¬¡åˆ†ææ—¶ similar_past_decisions å­—æ®µéç©ºï¼ˆéœ€å…ˆæœ‰å†å²ï¼‰        | è¿”å›è‡³å¤š5æ¡å†å²å†³ç­–æ‘˜è¦ï¼Œanalysis_date å‡ \< å½“å‰ analysis_date |
| MS-INT-004 | æƒ…æ™¯è®°å¿†æ£€ç´¢è¿”å›çš„å†å²å†³ç­– analysis_date å‡ \<= ctx.analysis_date | æ— æœªæ¥æ—¥æœŸå†³ç­–æ³„éœ²ï¼ˆREG-007 çš„é›†æˆç‰ˆæœ¬ï¼‰                        |

# 5. å›å½’æµ‹è¯•å¥—ä»¶ï¼ˆv2.0 æ›´æ–°ï¼‰

> âš ï¸ ä»¥ä¸‹æ‰€æœ‰å›å½’æµ‹è¯•åœ¨æ¯æ¬¡ PR åˆå¹¶æ—¶å¿…é¡»è¿è¡Œï¼Œä»»ä½•ä¸€ä¸ªå¤±è´¥å‡è§†ä¸ºä¸¥é‡ç¼ºé™·ï¼Œé˜»æ­¢éƒ¨ç½²ã€‚
>
> ğŸ“Œ REG-001 åˆ° REG-005 ä¸ TSD v1.0 ç¬¬ 4.2 èŠ‚å®Œå…¨ä¸€è‡´ï¼Œä¸é‡å¤åˆ—å‡ºã€‚v2.0 æ–°å¢ REG-006/007ã€‚

| **æµ‹è¯•ID** | **æµ‹è¯•åç§°**           | **æµ‹è¯•å†…å®¹**                                     | **é€šè¿‡æ ‡å‡†**                                                     |
|------------|------------------------|--------------------------------------------------|------------------------------------------------------------------|
| REG-001    | AAPLå‰è§†åå·®æ¶ˆé™¤       | 2024-01-02 analysis_dateï¼Œæ£€æŸ¥æ•°æ®è®¿é—®å®¡è®¡æ—¥å¿—   | å®¡è®¡æ—¥å¿— is_compliant=False è®°å½•æ•°é‡ä¸º0                          |
| REG-002    | è¿ç»­5æ—¥å†³ç­–å¤šæ ·æ€§      | AAPL 2024-01-02è‡³08é€æ—¥åˆ†æï¼ˆMock LLMï¼‰          | 5ä¸ªå†³ç­–ä¸­è‡³å°‘å«2ç§ä¸åŒ action                                    |
| REG-003    | BACKTESTå®æ—¶APIé”å®š    | BACKTESTæ¨¡å¼è°ƒç”¨ä»»ä½•å®æ—¶API                      | æ‰€æœ‰è°ƒç”¨æŠ›å‡º RealtimeAPIBlockedError                             |
| REG-004    | å†³ç­–å¯å¤ç°æ€§           | ç›¸åŒFixtureä¸¤æ¬¡L2åˆ†æï¼ˆMock LLMï¼Œtemperature=0ï¼‰ | ä¸¤æ¬¡ action å’Œ confidence å®Œå…¨ç›¸åŒ                               |
| REG-005    | æ¸©åº¦å‚æ•°é”å®š           | æ£€æŸ¥æ‰€æœ‰LLMå®ä¾‹åŒ–è°ƒç”¨                            | åŒ…æ‹¬DeepSeekClient/DashScopeClientï¼Œtemperatureå‡ä¸º0.0           |
| REG-006    | æ–°é—»è¿‡æ»¤ä¸å¼•å…¥æœªæ¥æ•°æ® | å«æœªæ¥æ–°é—»çš„Fixtureç»è¿‡å®Œæ•´åˆ†ææµç¨‹              | æœ€ç»ˆ news_analyst æ”¶åˆ°çš„æ–°é—» published_at å…¨éƒ¨ \<= analysis_date |
| REG-007    | æƒ…æ™¯è®°å¿†ä¸å¼•å…¥æœªæ¥å†³ç­– | æ£€ç´¢æƒ…æ™¯è®°å¿†å¹¶éªŒè¯è¿”å›å†³ç­–çš„ analysis_date       | æ‰€æœ‰è¿”å›çš„å†å²å†³ç­– analysis_date \< å½“å‰ ctx.analysis_date       |

# 6. Fixture æ•°æ®è§„èŒƒï¼ˆv2.0 æ›´æ–°ï¼‰

```python
ğŸ“Œ tests/fixtures/ ç›®å½•ç»“æ„ä¸ TSD v1.0 ç¬¬ 5 èŠ‚ç›¸åŒï¼Œv2.0 æ–°å¢ä»¥ä¸‹ Fixture æ–‡ä»¶ã€‚

tests/fixtures/  
â”œâ”€â”€ ohlcv/  
â”‚ â”œâ”€â”€ aapl_ohlcv_2024_01.csv # å·²æœ‰  
â”‚ â”œâ”€â”€ nvda_ohlcv_2024_q1.csv # v2.0 æ–°å¢ï¼ˆç»„åˆåˆ†ææµ‹è¯•ç”¨ï¼‰  
â”‚ â””â”€â”€ msft_ohlcv_2024_q1.csv # v2.0 æ–°å¢  
â”œâ”€â”€ news/  
â”‚ â”œâ”€â”€ aapl_news_mixed_dates.json # å·²æœ‰ï¼ˆå«æœªæ¥æ–°é—»ï¼‰  
â”‚ â”œâ”€â”€ aapl_news_low_relevance.json # v2.0 æ–°å¢ï¼ˆL2è¿‡æ»¤æµ‹è¯•ï¼‰  
â”‚ â””â”€â”€ aapl_news_duplicates.json # v2.0 æ–°å¢ï¼ˆL3å»é‡æµ‹è¯•ï¼Œå«ç›¸ä¼¼æ–°é—»å¯¹ï¼‰  
â”œâ”€â”€ portfolio/  
â”‚ â”œâ”€â”€ high_correlation_pair.json # v2.0 æ–°å¢ï¼ˆAAPL+NVDAç›¸å…³ç³»æ•°0.85ï¼‰  
â”‚ â””â”€â”€ low_correlation_set.json # v2.0 æ–°å¢ï¼ˆç›¸å…³ç³»æ•°<0.5çš„3åªè‚¡ç¥¨ï¼‰  
â””â”€â”€ llm_responses/  
â”œâ”€â”€ valid_trade_decision.json # å·²æœ‰  
â””â”€â”€ deepseek_rate_limit_429.json # v2.0 æ–°å¢ï¼ˆ429å“åº”ä½“ï¼‰
```

## conftest.py æ–°å¢ Fixtureï¼ˆv2.0ï¼‰

```python
# tests/conftest.py æ–°å¢  
@pytest.fixture  
def portfolio_ctx_2024_q1() -> TemporalContext:  
"""ç»„åˆåˆ†ææµ‹è¯•æ ‡å‡†ä¸Šä¸‹æ–‡ï¼š2024å¹´3æœˆæœ«"""  
return TemporalContext.for_live(date(2024, 3, 29))  
  
@pytest.fixture  
def mock_high_correlation_ohlcv(mocker):  
"""Mock è¿”å›é«˜ç›¸å…³çš„åŒè‚¡OHLCVæ•°æ®ï¼ˆç”¨äºHHIçº¦æŸæµ‹è¯•ï¼‰"""  
...  
  
@pytest.fixture  
def aapl_news_with_duplicates() -> List[dict]:  
return json.load(open("tests/fixtures/news/aapl_news_duplicates.json"))  
  
@pytest.fixture  
def mock_chroma_unavailable(mocker):  
"""Mock ChromaDB åˆå§‹åŒ–å¤±è´¥ï¼ˆç”¨äºé™çº§æµ‹è¯•ï¼‰"""  
mocker.patch("chromadb.Client", side_effect=Exception("ChromaDB unavailable"))
```
