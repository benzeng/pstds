**个人专用股票交易决策系统**

*PSTDS --- Personal Stock Trading Decision System*

**功能需求文档（FRD）v2.0**

*基于 TradingAgents (arXiv:2412.20138) 深度改进版*

综合改进方案 + PSTDS 用户方案 \| 2026年2月 \| 版本 v2.0

**1. 文档说明**

**1.1 编写目的**

本文档在原 PSTDS v1.0 FRD 基础上，综合融入 Tauric Research
架构改进方案，形成 v2.0 版功能需求规范。相较
v1.0，本版本重点强化了数据时间隔离（消除前视偏差）、结构化输出与确定性保障、成本分级控制、回测引擎设计以及智能体系统的工程可信度，同时保留并增强了多市场覆盖、多
LLM 支持、Web UI 等原版设计的优秀部分。

系统正式名称：Personal Stock Trading Decision System（PSTDS），版本
v2.0。

依据来源：TradingAgents 论文（arXiv:2412.20138）、Trading-R1
技术报告（arXiv:2509.11420）、TradingAgents v0.2.0 源代码、PSTDS v1.0
用户需求文档、Tauric Research 架构改进分析报告。

**1.2 核心改进要点（v1.0 → v2.0）**

  ----------------------------------------------------------------------------------------------
  **改进维度**    **v1.0 原有设计**               **v2.0 改进内容**
  --------------- ------------------------------- ----------------------------------------------
  数据时间隔离    未提及，存在前视偏差风险        引入 TemporalGuard
                                                  时间隔离层，所有数据访问强制经过时间边界校验

  输出确定性      temperature=0.3，自由文本输出   temperature=0.0（生产模式锁定），Pydantic
                                                  结构化校验，决策哈希缓存

  成本控制        提及成本估算，无分级策略        4 级分析深度 + Token 预算硬性上限 +
                                                  本地模型分流策略

  回测引擎        v1.1 规划，架构预留接口         v2.0 核心功能，完整设计含 6
                                                  个组件和标准绩效指标体系

  智能体质量      原版角色无质量保障              新增数据质量守卫 +
                                                  辩论裁判员，提示词工程规范化

  记忆系统        未涉及                          三层记忆架构（短期/中期向量/长期模式）

  A股/港股支持    AKShare 适配                    保留并增强，补充时间隔离和数据质量校验
  ----------------------------------------------------------------------------------------------

**1.3 术语说明**

  -------------------------------------------------------------------
  **术语**        **说明**
  --------------- ---------------------------------------------------
  PSTDS           Personal Stock Trading Decision System，本系统全称

  TemporalGuard   时间隔离层，所有数据访问的时间边界守卫组件（v2.0
                  新增）

  analysis_date   分析基准日期，系统仅允许访问该日期及以前的数据

  分析深度级别    L0-L3 四个级别，控制模型选择、辩论轮次和分析范围

  深度思考模型    用于复杂推理的 LLM（如 Claude
                  Sonnet、GPT-4o、DeepSeek-R1）

  快速思考模型    用于轻量任务的 LLM（如 GPT-4o-mini、Qwen3-4B 本地）

  TradingAgents   Tauric Research 开源多智能体 LLM
                  交易框架，本系统核心引擎
  -------------------------------------------------------------------

**2. 产品概述**

**2.1 产品定位**

PSTDS
是面向个人投资者的本地化、可私有部署的智能股票研究辅助工具。它不是自动化交易机器人，而是模拟专业投研团队工作方式的决策辅助系统，支持美股（NYSE/NASDAQ）、A股（沪深）、港股（HKEX）三大市场。系统不产生实盘交易指令，所有决策建议仅供参考。

**2.2 核心设计原则**

- **①** 时间隔离优先：所有数据访问经过 TemporalGuard
  校验，彻底消除前视偏差，这是系统可信度的根本保障。

- **②** 确定性输出：生产分析模式温度参数锁定为
  0，关键决策输出强制结构化，确保结论可复现可审计。

- **③** 成本可控：分级推理策略 + Token 预算硬性上限 +
  本地模型分流，单次深度分析目标成本 \< \$0.30。

- **④** 隐私优先：所有数据与模型本地运行，使用本地 Ollama 时可完全离线。

- **⑤**
  可解释性：每条决策建议附带完整证据链与数据引用，支持血缘追踪，不接受黑盒输出。

- **⑥** 多市场覆盖：美股、A股、港股统一接口，市场路由对上层透明。

- **⑦**
  渐进增强：核心功能开箱即用，高级功能（回测、Trading-R1）可插件化扩展。

**2.3 使用场景与用户故事**

**核心使用场景**

  ---------- -----------------------------------------------------------------------------
  **场景 A** 每日盘前分析（L1级，\<
             3分钟）：开盘前快速获取自选股多维度摘要与当日建议，通过自动化定时任务推送。

  ---------- -----------------------------------------------------------------------------

  ---------- ----------------------------------------------------------------------
  **场景 B** 个股深度研究（L2-L3级，\<
             15分钟）：建仓前触发全套多智能体辩论分析，获取结构化多角度研究报告。

  ---------- ----------------------------------------------------------------------

  ---------- ------------------------------------------------------------------------------------
  **场景 C** 策略回测验证（回测引擎）：对历史数据区间进行严格时间隔离回测，评估分析逻辑有效性。

  ---------- ------------------------------------------------------------------------------------

  ---------- --------------------------------------------------------------------------------
  **场景 D** 持仓风险监控（定时扫描）：对当前持仓组合定期风险扫描，识别需要关注的异常信号。

  ---------- --------------------------------------------------------------------------------

**用户故事（User Stories）**

  ------------------------------------------------------------------------------------------------------------------
  **ID**   **功能描述**                                             **验收标准**
  -------- -------------------------------------------------------- ------------------------------------------------
  US-01    输入股票代码与分析日期，获得结构化买/持/卖建议           决策结果含置信度评分，L2级分析 ≤ 15 分钟完成

  US-02    查看分析师报告详细推理过程与数据依据（含数据来源引用）   每条结论可展开查看数据来源URL和时间戳

  US-03    批量提交多只股票进行并行分析                             支持至少 10 只股票队列，asyncio 并行执行

  US-04    查看历史分析记录并与当前分析趋势对比                     历史记录可检索，保留不少于 2 年

  US-05    对自选股列表进行定时自动分析并推送通知                   支持 Cron 配置，邮件/桌面通知双渠道

  US-06    在不同 LLM 提供商间灵活切换控制成本                      切换无需改代码，配置即生效，显示预计费用

  US-07    对指定历史区间进行回测，查看绩效报告                     输出夏普比率、最大回撤、年化收益等标准指标

  US-08    将分析报告导出为 PDF/Word/Markdown                       一键导出，包含封面、各报告、辩论摘要和免责声明

  US-09    设置月度 API 费用上限，超限自动切换本地模型              告警及时，自动降级无感切换

  US-10    查看每次分析的 Token 消耗与费用明细                      UI 中实时显示，月度趋势可查
  ------------------------------------------------------------------------------------------------------------------

**3. 核心功能需求**

**3.1 数据时间隔离层（TemporalGuard）------最高优先级**

  -----------------------------------------------------------------------------------------------------------
  *此为 v2.0 相较 v1.0 最关键的新增需求，直接决定系统可信度。原 TradingAgents
  框架存在致命的前视偏差------在历史回测时系统可访问分析日期之后的数据，导致回测结果完全失效。TemporalGuard
  从架构层面根治这一问题。*

  -----------------------------------------------------------------------------------------------------------

**FR-TG01：时间边界强制执行**

- 所有数据查询请求必须携带 analysis_date
  参数，数据层自动过滤所有晚于该日期的数据。

- 新闻文章必须校验 published_at \<
  analysis_date，不符合条件的新闻强制丢弃并记录审计日志。

- 回测模式下，禁止所有指向外部实时 API
  的调用，强制使用本地历史缓存数据。

**FR-TG02：LLM 知识隔离声明**

- 所有智能体系统提示词必须包含标准时间锚定声明：「你当前正在分析
  {analysis_date}
  这一天的市场情况，不得引用该日期之后发生的任何事件或数据。」

- 提示词必须包含数据来源约束：「你的所有分析必须基于以下明确提供的数据，不得使用训练记忆中的具体财务数字或新闻内容。」

**FR-TG03：数据访问审计**

- 每条被智能体引用的数据必须记录其数据来源、时间戳、获取方式，形成完整数据血缘链。

- 分析完成后，数据质量报告中展示所有数据的时间范围合规性检查结果。

**3.2 核心智能体引擎（基于 TradingAgents）**

**3.2.1 分析师团队（四类分析师）**

  -----------------------------------------------------------------------------------------------------------------------------------
  **分析师角色**   **核心职责**                           **数据来源**             **v2.0 改进点**
  ---------------- -------------------------------------- ------------------------ --------------------------------------------------
  技术分析师       MACD、RSI、布林带、均线、K线形态       本地计算（pandas-ta）+   引入价格异常检测（分拆/停牌）；A股通达信公式转换
                                                          yfinance/AKShare 行情    

  基本面分析师     财务报表、PE/PB/ROE 估值、内在价值     Alpha Vantage / AKShare  强制从 API 拉取，禁止引用训练记忆中的财务数字
                                                          / SEC EDGAR              

  新闻分析师       宏观新闻、行业动态、政策影响解读       Alpha Vantage News /     时间戳严格校验；三级相关性过滤（阈值 0.6）
                                                          NewsAPI / 财联社 RSS     

  情绪分析师       社交情绪评分、散户情绪量化、舆情趋势   Reddit / 东方财富股吧 /  每条评分附带来源URL和原始文本摘要；24h/7d
                                                          StockTwits               双时间窗口
  -----------------------------------------------------------------------------------------------------------------------------------

**3.2.2 研究员团队（辩论机制改进）**

- FR-R01：多头研究员（Bullish）和空头研究员（Bearish）两个对立角色，辩论轮次按分析深度级别动态配置（L1:1轮，L2:2轮，L3:3轮，最大5轮）。

- FR-R02：立场随机化------每次辩论随机分配 LLM
  实例担任多空方，避免固定立场偏好。

- FR-R03：论据引用要求------每个辩论论点必须引用具体数据（如
  PE=X，高于行业均值 Y%），禁止纯粹定性断言。

- FR-R04：防连续 BUY 机制------当连续 3 次以上产生 BUY
  决策时，自动触发加强空方辩论模式。

- FR-R05：每轮辩论记录完整对话历史，置信度评分（0-10分），可在 UI
  中展开查看。

**3.2.3 新增智能体角色（v2.0 新增）**

  ------------------ --------------------------------------------------------------------------------------------------------------------------------------------------
   **数据质量守卫**  在分析流程启动前，对所有输入数据进行质量检查：标记缺失值、异常值、时间戳错误、数据不连续等问题，生成数据质量报告并评分。低于质量阈值时警告用户。

  ------------------ --------------------------------------------------------------------------------------------------------------------------------------------------

  ---------------- ------------------------------------------------------------------------------------------------------------------------------------
   **辩论裁判员**  独立于多空双方的评估者，从逻辑一致性、数据充分性、假设合理性、反驳有效性四个维度评分。辩论质量低于阈值时，结论标记为「低置信度」。

  ---------------- ------------------------------------------------------------------------------------------------------------------------------------

**3.2.4 交易员与风险管理（功能增强）**

- FR-T01：交易员输出五档决策：STRONG_BUY / BUY / HOLD / SELL /
  STRONG_SELL（原版三档扩展为五档）。

- FR-T02：投资计划包含结构化字段：决策方向、建议仓位比例、目标价位区间（低/高）、持仓时间窗口、波动率调整系数。

- FR-T03：支持三种风险偏好配置（保守/平衡/激进），动态调整决策阈值。

- FR-PM01：风险管理团队从三维度独立评估：市场波动性、流动性、持仓集中度，v2.0
  新增组合级相关性风险检查。

- FR-PM02：组合经理输出明确的批准/否决/修改决定，附带修改理由的结构化
  JSON 输出。

- FR-PM03：支持个人持仓信息录入，使风险评估结合实际仓位（可选功能）。

**3.3 结构化输出与确定性需求（v2.0 强化）**

  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  *所有最终交易决策必须输出标准 JSON
  对象，包含：action（STRONG_BUY/BUY/HOLD/SELL/STRONG_SELL）、confidence（0.0-1.0）、conviction（HIGH/MEDIUM/LOW）、primary_reason（≤100字）、target_price_low、target_price_high、time_horizon、risk_factors（列表）、data_sources（引用来源列表，含时间戳）、volatility_adjustment、analysis_date、analysis_timestamp。当数据不足时输出
  INSUFFICIENT_DATA 标志，禁止强行给出结论。*

  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

- FR-SO01：生产分析模式 LLM 温度参数锁定为
  0.0，禁止随机性引入（配置文件强制覆盖）。

- FR-SO02：使用 Pydantic 模型对 LLM
  输出进行结构化校验，不符合格式触发最多 3
  次重试，仍失败记录错误并标记该分析节点为 FAILED。

- FR-SO03：对每次分析的输入数据 +
  模型配置计算哈希值，相同哈希直接返回缓存结果，避免重复 API 调用。

**3.4 分析深度分级需求（成本控制核心）**

  ------------------------------------------------------------------------------------------------------
  **级别**   **名称**           **辩论轮次/分析师**   **预计时间**   **目标成本**   **典型场景**
  ---------- ------------------ --------------------- -------------- -------------- --------------------
  L0         快速扫描           0轮，仅技术           \< 30秒/股     \< \$0.01      每日多股批量筛选

  L1         标准分析           1轮，技术+新闻        2-4 分钟       \< \$0.05      每日盘前自选股分析

  L2 ⭐      深度分析（推荐）   2轮，全部4类          8-15 分钟      \< \$0.20      建仓前研究

  L3         全面研究           3-5轮，全部4类        15-30 分钟     \< \$0.50      重仓前专项研究
  ------------------------------------------------------------------------------------------------------

- FR-CL01：Token 预算硬性上限------每次分析启动前估算 Token
  消耗，超出预算自动降级分析深度或截断输入，不允许无限制消耗。

- FR-CL02：输入侧截断------新闻摘要 ≤ 500 tokens/条，财报摘要 ≤ 2000
  tokens，强制执行不可配置。

- FR-CL03：月度费用阈值告警------超过用户设定月度上限时，发送告警并自动切换到本地
  Ollama 模型，直到下个计费周期。

**4. 数据管理需求**

**4.1 市场数据获取与多市场支持**

  -------------------------------------------------------------------------------------------------------
  **适配器**            **覆盖市场**        **数据类型**                   **成本**    **时间隔离支持**
  --------------------- ------------------- ------------------------------ ----------- ------------------
  YFinanceAdapter       美股、港股、ETF     行情、基本面、财务             免费        ✓ 支持 date
                                                                                       参数过滤

  AlphaVantageAdapter   美股（主/备）       行情、新闻、基本面             免费 25     ✓ 历史端点支持
                                                                           req/day     

  AKShareAdapter        A股（沪深）、港股   行情、财务、资金流、东财情绪   免费开源    ✓ 支持历史区间

  LocalCSVAdapter       任意市场            用户自备本地数据               零成本      ✓ 天然隔离
  -------------------------------------------------------------------------------------------------------

- FR-D01：市场路由规则------6位纯数字60/000/002/300开头→A股（AKShare）；4-5位数字+.HK→港股；1-5位英文→美股（yfinance）。

- FR-D02：技术指标必须在本地计算（pandas-ta），禁止依赖外部 API
  计算指标，确保零成本且消除限速风险。

- FR-D03：数据获取失败时自动切换备用源，降级事件记录到日志和数据质量报告。

- FR-D04：所有数据时间戳统一转换为 UTC 存储，使用 ISO 8601 格式。

**4.2 新闻与情绪数据质量控制**

- FR-D05：新闻时间戳严格校验------published_at 必须 ≤
  analysis_date，否则强制丢弃。

- FR-D06：三级新闻过滤------语义相关性评分 \> 0.6（基于 TF-IDF
  或嵌入向量相似度）方可进入分析流程。

- FR-D07：新闻去重基于内容语义相似度，而非仅标题匹配。

- FR-D08：情绪数据提供 24 小时、7
  天两个时间窗口的趋势统计，每条评分附带来源 URL。

**4.3 数据持久化需求**

  --------------------------------------------------------------------------------------------
  **存储组件**         **存储内容**                             **保留策略**
  -------------------- ---------------------------------------- ------------------------------
  SQLite               OHLCV 行情、技术指标缓存（TTL            行情数据永久保留（用于回测）
  market_cache.db      24h）、新闻缓存（TTL 6h）                

  MongoDB analyses     Agent                                    永久保留，≥ 2 年
  集合                 分析结果全文、辩论记录、结构化决策摘要   

  MongoDB watchlist    自选股列表、分组标签、定时配置           用户操作管理
  集合                                                          

  MongoDB cost_records 每次分析的 Token                         保留 1 年
  集合                 消耗、费用明细，月度汇总                 

  文件系统 data/raw/   Parquet 格式原始行情、JSON               永久保留，用于回测
                       格式新闻和财务（只追加）                 

  文件系统             导出的 PDF/DOCX/MD 报告                  用户自行管理
  data/reports/                                                 
  --------------------------------------------------------------------------------------------

- FR-D09：原始数据采用追加式写入，一旦写入不得修改，保证历史数据不可篡改（用于回测可复现性）。

- FR-D10：支持数据导出接口，CSV / JSON 格式。

**5. 回测引擎需求（v2.0 核心功能）**

  -------------------------------------------------------------------
  *回测引擎是 v2.0
  从「研究原型」升级为「可信工具」的关键里程碑。所有回测必须经过
  TemporalGuard 时间隔离层，确保零前视偏差。*

  -------------------------------------------------------------------

**5.1 回测引擎核心组件**

  ------------------------------------------------------------------------------
  **组件**                **功能说明**
  ----------------------- ------------------------------------------------------
  日历迭代器 (Calendar    按交易日顺序推进
  Iterator)               analysis_date，每次仅前进一天，绝不预读未来数据

  历史数据快照 (Data      每个交易日在 TemporalGuard
  Snapshot)               约束下生成数据快照，智能体只能访问当日及以前的数据

  虚拟组合管理 (Virtual   模拟账户资金、持仓量、买卖成本（含手续费和滑点）
  Portfolio)              

  信号执行引擎 (Signal    将 BUY/HOLD/SELL
  Executor)               信号按配置的资金管理规则转换为模拟交易

  绩效计算器 (Performance 每日计算并累积核心绩效指标
  Calculator)             

  回测报告生成器 (Report  生成含逐日决策记录、绩效曲线、归因分析的完整回测报告
  Generator)              
  ------------------------------------------------------------------------------

**5.2 回测绩效指标体系**

  --------------------------------------------------------------------------------------
  **指标类别**      **具体指标**
  ----------------- --------------------------------------------------------------------
  收益类            累计收益率、年化收益率、超额收益（对比基准
                    Buy&Hold、沪深300、标普500）

  风险类            最大回撤、年化波动率、VaR（95%置信度）、条件VaR（CVaR）

  综合类            夏普比率（年化）、卡尔马比率（年化收益/最大回撤）、信息比率

  决策质量类        预测准确率（涨跌方向）、信号覆盖率、决策一致性得分、辩论质量平均分
  --------------------------------------------------------------------------------------

**5.3 回测功能需求**

- FR-BT01：支持指定股票在历史日期区间内逐日执行 PSTDS
  分析流程并模拟交易。

- FR-BT02：支持参数扫描对比实验（不同分析深度、不同
  LLM、不同风险偏好的回测结果对比）。

- FR-BT03：回测结果可视化展示净值曲线，支持与基准指数对比。

- FR-BT04：回测完成后保存完整快照（含每日输入数据和决策输出），支持事后审查任意一天的分析依据。

- FR-BT05：禁止在回测集上调参后不做样本外验证，系统需提供样本外测试集划分工具。

**6. LLM 管理需求**

**6.1 支持的 LLM 提供商**

  -------------------------------------------------------------------------------------------
  **提供商**           **代表模型（深度/快速）**           **适用场景**        **来源**
  -------------------- ----------------------------------- ------------------- --------------
  OpenAI               gpt-4o（深）/ gpt-4o-mini（快）     全部 Agent          原版支持

  Anthropic            claude-sonnet-4-6（深）/            全部 Agent          原版支持
                       claude-haiku-4-5（快）                                  

  Google Gemini        gemini-2.5-pro（深）/               全部 Agent          原版支持
                       gemini-2.0-flash（快）                                  

  DeepSeek             deepseek-reasoner（深）/            全部                v2.0 新增
                       deepseek-chat（快）                 Agent，成本优势     

  阿里 DashScope       qwen-max（深）/ qwen-turbo（快）    A股分析优化         v2.0 新增

  Ollama 本地          Qwen3-4B-Q4_K_M（全角色，零成本）   批量筛选/成本控制   原版+扩展

  OpenRouter           聚合多提供商按需路由                全部 Agent          原版支持

  Trading-R1（预留）   Qwen3-4B 金融微调版（待开源）       交易员+风险管理     预留槽位
  -------------------------------------------------------------------------------------------

**6.2 LLM 使用策略（分任务路由）**

  ------------------------------------------------------------------------------
  **任务类型**                  **推荐模型（本地）**   **推荐模型（云端）**
  ----------------------------- ---------------------- -------------------------
  数据格式化与提取（L0/L1）     Qwen3-4B / Ollama      GPT-4o-mini / Claude
                                                       Haiku

  新闻摘要与情绪分析（L1/L2）   Qwen3-4B / Ollama      GPT-4o-mini / Gemini
                                                       Flash

  技术面 + 基本面分析（L2）     可选本地（精度有限）   Claude Sonnet / GPT-4o

  Bull/Bear 辩论（L2/L3）       云端优先               Claude Sonnet /
                                                       DeepSeek-Reasoner

  最终决策综合（L2/L3）         云端优先（最高精度）   Claude Sonnet / o4-mini

  每日批量筛选（L0）            Qwen3-4B 全流程        不推荐（成本过高）
  ------------------------------------------------------------------------------

- FR-L01：深度思考模型与快速思考模型须可分别配置，也可按分析深度级别自动选择。

- FR-L02：API Key 使用 OS Keychain 或 AES-256
  加密存储，禁止明文写入配置文件或版本控制。

- FR-L03：实现调用限流与令牌桶重试机制，避免触发 API Rate
  Limit，最大重试 3 次。

- FR-L04：每次分析完成后显示实际 Token 消耗和费用（USD/CNY
  双显），写入月度统计。

- FR-L05：本地 Ollama 模式支持 Qwen3-4B Q4_K_M
  量化模型，可完全离线运行。

**7. 用户界面需求**

**7.1 Web 界面（Streamlit）**

- FR-UI01：基于 Streamlit 实现，http://localhost:8501
  访问，支持响应式布局（PC/平板/手机）。

- FR-UI02：深色/浅色主题切换。

- FR-UI03：分析进度实时显示------按节点权重展示总体进度条（技术15%/基本面15%/新闻10%/情绪10%/辩论30%/风险10%/决策10%），动态更新当前
  Agent 名称。

- FR-UI04：分析报告分标签页展示：概览、技术面（含K线图）、基本面、新闻面、情绪面、辩论过程（可展开全文）、最终决策（含结构化
  JSON 摘要）。

- FR-UI05：K线图叠加技术指标（MACD、RSI、布林带、均线、成交量），使用
  Plotly 交互式图表，支持区间缩放、十字线、PNG导出。

- FR-UI06：自选股列表管理------分组标签、批量分析、定时配置，最多 10
  只股票并行队列。

- FR-UI07：历史记录检索------按股票代码、日期、决策方向过滤，支持决策趋势图对比。

- FR-UI08：成本仪表盘------本次分析消耗、月度趋势图、月度上限告警配置。

**7.2 报告导出**

- FR-EX01：支持单次分析报告导出
  PDF（WeasyPrint）、Word（python-docx）、Markdown 三种格式。

- FR-EX02：导出报告包含：封面页、各分析师报告、辩论摘要、最终结构化决策（含数据来源列表）、免责声明。

**7.3 自动化与通知**

- FR-NT01：定时任务支持 Cron 表达式配置（如工作日 08:30
  自动分析自选股），配置存储于 MongoDB。

- FR-NT02：任务状态机：PENDING → RUNNING → COMPLETED /
  FAILED，支持自动重试最多 3 次。

- FR-NT03：通知渠道：桌面原生通知（系统级）、邮件通知（SMTP 配置）。

**8. 非功能性需求**

  --------------------------------------------------------------------------------
  **NFR 类别**         **量化指标**               **设计原则**
  -------------------- -------------------------- --------------------------------
  可信度（最高优先）   回测结果前视偏差为零       TemporalGuard 时间隔离 +
                                                  数据访问审计日志

  成本效益             L2 深度分析 \< \$0.30/次   分级推理 + Token 预算硬性上限 +
                                                  本地模型分流

  确定性               相同输入 95% 结果一致      temperature=0.0 锁定 + Pydantic
                                                  结构化校验 + 决策哈希缓存

  响应速度             L1 盘前分析 \< 4 分钟；L2  asyncio 并行 + SQLite 缓存命中率
                       \< 15 分钟                 \> 70%

  可解释性             每个结论均有数据来源引用   数据血缘追踪 + 时间戳引用链

  安全性               API Key 零明文存储         OS Keychain / AES-256 加密；本地
                                                  Ollama 模式可完全断网

  可维护性             核心数据层单元测试覆盖率   单元测试 + 集成测试，CI/CD
                       \> 80%                     流水线

  并发性               ≥ 10 只股票并行队列        asyncio + 令牌桶限流，受 LLM API
                                                  Rate Limit 约束

  运行环境             macOS 13+ / Ubuntu 22.04+  Python 3.11+，Docker Compose
                       / Windows 11 WSL2          一键部署
  --------------------------------------------------------------------------------

**9. 功能范围边界与免责声明**

**9.1 Out of Scope（功能范围外）**

- 实盘自动化交易执行（任何版本均不提供）

- 期货、期权、外汇等衍生品分析（v2.0 不支持）

- 多用户并发与权限管理（个人专用，单用户）

- 移动端原生 App（iOS/Android）

- 与任何券商 API 直连下单

**9.2 已知技术约束**

- LLM 输出在 temperature \> 0 时具有随机性，v2.0 通过 temperature=0 +
  结构化校验缓解但无法完全消除。

- A股数据的实时性受 AKShare 免费接口限制，通常有 15-30
  分钟延迟，不适用于日内交易场景。

- 本地 Qwen3-4B 的分析质量低于 GPT-4o / Claude
  Sonnet，适合低成本草稿分析和批量筛选。

- Trading-R1 微调模型尚未开源，预留接口，待官方发布后通过配置启用。

  ---------------------------------------------------------------------------------------------------------------------------------
  *重要免责声明：PSTDS
  系统仅为个人研究辅助工具，所有分析结果和投资建议仅供参考，不构成任何形式的投资建议或财务顾问意见。系统基于历史数据和 LLM
  推理生成结论，存在不可避免的不确定性和偏差。最终投资决策须由用户自主判断，系统开发者不承担因使用本系统产生的任何投资损失责任。*

  ---------------------------------------------------------------------------------------------------------------------------------
